# üí∞ BROCRAFT v‚àû ‚Äî GUIA COMPARATIVO DE APIs IA

## 1. COMPARATIVO DETALHADO (Nov 2025)

### 1.1 CUSTOS POR MODELO

| Provider | Modelo | Input (1M tokens) | Output (1M tokens) | Contexto | Velocidade |
|----------|--------|-------------------|-------------------|----------|------------|
| **Anthropic** | Claude Sonnet 3.5 | $3.00 | $15.00 | 200k | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **Anthropic** | Claude Haiku 3.5 | $1.00 | $5.00 | 200k | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **OpenAI** | GPT-4o | $2.50 | $10.00 | 128k | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **OpenAI** | GPT-4o-mini | $0.15 | $0.60 | 128k | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê |
| **OpenAI** | GPT-3.5-turbo | $0.50 | $1.50 | 16k | ‚≠ê‚≠ê‚≠ê |
| **xAI** | Grok Beta | $5.00 | $15.00 | 131k | ‚≠ê‚≠ê |
| **Google** | Gemini 1.5 Flash | $0.075 | $0.30 | 1M | ‚≠ê‚≠ê‚≠ê‚≠ê |
| **Google** | Gemini 1.5 Pro | $1.25 | $5.00 | 2M | ‚≠ê‚≠ê‚≠ê |

---

## 2. AN√ÅLISE PARA BROCRAFT

### 2.1 CASOS DE USO

| Cen√°rio | Melhor Escolha | Por qu√™ | Custo/1000 msgs |
|---------|----------------|---------|-----------------|
| **Resposta curta (<200 tokens)** | GPT-4o-mini | Ultra r√°pido e barato | R$ 0.90 |
| **Resposta longa (500+ tokens)** | Claude Haiku | Melhor custo-benef√≠cio | R$ 3.00 |
| **Usu√°rio FREE** | GPT-4o-mini | Mant√©m custo baixo | R$ 0.90 |
| **Usu√°rio MESTRE** | Claude Sonnet 3.5 | Qualidade superior | R$ 9.00 |
| **Troubleshooting complexo** | Claude Sonnet 3.5 | Racioc√≠nio profundo | R$ 9.00 |
| **Receitas simples** | GPT-4o-mini | Resposta padr√£o | R$ 0.90 |

### 2.2 ESTRAT√âGIA RECOMENDADA

```typescript
// Roteamento inteligente
function selectModel(context: {
  userTier: 'FREE' | 'MESTRE' | 'CLUBE_BRO';
  messageType: 'receita' | 'troubleshooting' | 'chat';
  expectedTokens: number;
}) {
  // Usu√°rios MESTRE ‚Üí sempre Claude Sonnet
  if (context.userTier === 'MESTRE' || context.userTier === 'CLUBE_BRO') {
    return 'claude-sonnet-3.5';
  }
  
  // Troubleshooting complexo ‚Üí Claude Haiku (bom e barato)
  if (context.messageType === 'troubleshooting') {
    return 'claude-haiku-3.5';
  }
  
  // Respostas longas para FREE ‚Üí Claude Haiku
  if (context.expectedTokens > 500) {
    return 'claude-haiku-3.5';
  }
  
  // Default: GPT-4o-mini (mais barato)
  return 'gpt-4o-mini';
}
```

---

## 3. ECONOMIA COM CACHE

### 3.1 SISTEMA DE CACHE INTELIGENTE

```typescript
// Estrutura de cache hier√°rquico
const CACHE_STRATEGY = {
  // Cache L1: Redis (respostas exatas)
  exact_match: {
    ttl: 3600, // 1 hora
    hit_rate: 40%, // 40% das perguntas s√£o similares
    economia: 100% // Custo zero quando hit
  },
  
  // Cache L2: Embeddings similares
  semantic_match: {
    ttl: 7200, // 2 horas
    hit_rate: 25%, // 25% s√£o semanticamente similares
    economia: 100%
  },
  
  // Sem cache: chama API
  miss: {
    hit_rate: 35%, // 35% s√£o √∫nicos
    economia: 0%
  }
};

// Economia total: 65% de redu√ß√£o de custos
```

### 3.2 IMPLEMENTA√á√ÉO DE CACHE

```typescript
// lib/cache.ts
import { Redis } from '@upstash/redis';
import { createHash } from 'crypto';

const redis = new Redis({
  url: process.env.UPSTASH_REDIS_URL!,
  token: process.env.UPSTASH_REDIS_TOKEN!,
});

export async function getCachedResponse(
  prompt: string,
  userId: string
): Promise<string | null> {
  // Hash do prompt
  const promptHash = createHash('sha256').update(prompt).digest('hex');
  const cacheKey = `chat:${userId}:${promptHash}`;
  
  // Buscar no cache
  const cached = await redis.get<string>(cacheKey);
  
  if (cached) {
    console.log('‚úÖ Cache HIT - Economia de 100%');
    return cached;
  }
  
  console.log('‚ùå Cache MISS - Chamando API');
  return null;
}

export async function setCachedResponse(
  prompt: string,
  userId: string,
  response: string
): Promise<void> {
  const promptHash = createHash('sha256').update(prompt).digest('hex');
  const cacheKey = `chat:${userId}:${promptHash}`;
  
  // Salvar com TTL de 1 hora
  await redis.set(cacheKey, response, { ex: 3600 });
}
```

---

## 4. PROJE√á√ÉO DE CUSTOS REAL

### 4.1 CEN√ÅRIO: 1.000 USU√ÅRIOS ATIVOS

```yaml
Perfil de Uso (por usu√°rio/m√™s):
  - Mensagens: 30
  - Tokens m√©dios por mensagem: 300 input + 600 output
  
Distribui√ß√£o:
  - FREE: 850 users (85%)
  - MESTRE: 100 users (10%)
  - CLUBE_BRO: 50 users (5%)

C√°lculo SEM cache:
  FREE (GPT-4o-mini):
    - 850 users √ó 30 msgs = 25,500 msgs
    - Custo: $0.15 + $0.60 = ~$1.00/1k msgs
    - Total: $25.50/m√™s
  
  MESTRE (Claude Sonnet):
    - 100 users √ó 30 msgs = 3,000 msgs
    - Custo: $3.00 + $15.00 = ~$18.00/1k msgs
    - Total: $54.00/m√™s
  
  CLUBE_BRO (Claude Sonnet):
    - 50 users √ó 30 msgs = 1,500 msgs
    - Total: $27.00/m√™s
  
TOTAL SEM CACHE: $106.50/m√™s (‚âà R$ 530)

C√°lculo COM cache (65% economia):
  TOTAL COM CACHE: $37.28/m√™s (‚âà R$ 185)
```

### 4.2 CEN√ÅRIO: 10.000 USU√ÅRIOS

```yaml
Distribui√ß√£o:
  - FREE: 8,500 (85%)
  - MESTRE: 1,000 (10%)
  - CLUBE_BRO: 500 (5%)

C√°lculo COM cache:
  FREE: $148/m√™s
  MESTRE: $189/m√™s
  CLUBE: $95/m√™s
  
TOTAL: $432/m√™s (‚âà R$ 2.160)

Receita (10k users):
  MESTRE: 1,000 √ó R$ 9,90 = R$ 9.900/m√™s
  CLUBE: 500 √ó R$ 19,90 = R$ 9.950/m√™s
  
TOTAL RECEITA: R$ 19.850/m√™s
MARGEM: R$ 17.690/m√™s (89% margem bruta!)
```

---

## 5. MELHORES PR√ÅTICAS

### 5.1 OTIMIZA√á√ÉO DE TOKENS

```typescript
// Reduza tokens mantendo qualidade
const OPTIMIZATION_TRICKS = {
  // 1. Comprimir hist√≥rico
  compress_history: (messages) => {
    // Mantenha s√≥ √∫ltimas 5 mensagens
    return messages.slice(-5);
  },
  
  // 2. Remover metadados desnecess√°rios
  strip_metadata: (message) => {
    return {
      role: message.role,
      content: message.content
      // Remove: timestamp, id, etc
    };
  },
  
  // 3. System prompt otimizado
  optimize_system: () => {
    // Use prompt curto para FREE, longo para MESTRE
    return userTier === 'FREE' 
      ? SHORT_PROMPT  // 200 tokens
      : FULL_PROMPT;  // 800 tokens
  }
};
```

### 5.2 MONITORAMENTO DE CUSTOS

```typescript
// lib/cost-tracker.ts
export async function trackCost(call: {
  model: string;
  inputTokens: number;
  outputTokens: number;
  userId: string;
}) {
  const cost = calculateCost(call.model, call.inputTokens, call.outputTokens);
  
  await db.costLog.create({
    data: {
      userId: call.userId,
      model: call.model,
      inputTokens: call.inputTokens,
      outputTokens: call.outputTokens,
      cost,
      timestamp: new Date(),
    }
  });
  
  // Alert se custo di√°rio > R$ 100
  const dailyCost = await getDailyCost();
  if (dailyCost > 20) { // $20 = ~R$100
    await sendAlertToSlack(`üö® Custo di√°rio: $${dailyCost}`);
  }
}
```

---

## 6. RECOMENDA√á√ÉO FINAL

### 6.1 STACK H√çBRIDO (MELHOR CUSTO-BENEF√çCIO)

```yaml
Setup Recomendado:
  Primary: 
    - FREE users ‚Üí GPT-4o-mini ($0.15/$0.60)
    - MESTRE users ‚Üí Claude Sonnet 3.5 ($3/$15)
  
  Fallback:
    - Se Anthropic down ‚Üí GPT-4o
    - Se OpenAI down ‚Üí Claude Haiku
  
  Cache:
    - Redis (Upstash Free tier)
    - 65% hit rate
    - Economia: R$ 345/m√™s (para 1k users)
  
  Custo Total Mensal (1k users):
    - APIs: R$ 185
    - Infra: R$ 0 (free tiers)
    - TOTAL: R$ 185
  
  Receita (1k users):
    - MESTRE: R$ 990
    - CLUBE: R$ 995
    - TOTAL: R$ 1.985
  
  MARGEM: 90.7%! üöÄ
```

### 6.2 PR√ìXIMOS PASSOS

```bash
# 1. Crie contas
https://console.anthropic.com/  # Claude
https://platform.openai.com/    # OpenAI
https://console.upstash.com/    # Redis

# 2. Pegue API keys

# 3. Configure .env
ANTHROPIC_API_KEY="sk-ant-..."
OPENAI_API_KEY="sk-..."
UPSTASH_REDIS_URL="..."

# 4. Teste ambos
npm run test:api

# 5. Deploy com ambos configurados
```

---

## 7. COMPARA√á√ÉO: GROK vs CLAUDE vs OPENAI

| Crit√©rio | Grok | Claude Sonnet | GPT-4o-mini | Vencedor |
|----------|------|---------------|-------------|----------|
| **Custo** | ‚ùå Muito caro | ‚ö†Ô∏è M√©dio | ‚úÖ Barato | GPT-4o-mini |
| **Qualidade** | ‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê | Claude |
| **Velocidade** | ‚ùå Lento | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | GPT-4o-mini |
| **Contexto** | 131k | 200k | 128k | Claude |
| **Personality** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚≠ê‚≠ê‚≠ê | Claude |
| **BROCRAFT** | ‚ùå | ‚úÖ MESTRE | ‚úÖ FREE | H√≠brido |

**VEREDICTO FINAL:**
- **FREE users:** GPT-4o-mini (barato, r√°pido, bom o suficiente)
- **MESTRE users:** Claude Sonnet 3.5 (melhor qualidade, vale o premium)
- **Grok:** ‚ùå Descartado (muito caro, sem vantagem)

---

**CONCLUS√ÉO: Use Claude + OpenAI h√≠brido com cache Redis**
**Economia: 65% | Margem: 90%+ | Qualidade: Excelente**

---

**Status: GUIA COMPLETO ‚úÖ**
**Salve como: BROCRAFT_API_COMPARISON.md**
